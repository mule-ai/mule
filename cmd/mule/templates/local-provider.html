<input type="hidden" id="repoPath" value="{{.Repository.Path}}">
function showEditIssueModal(issueElement, issueNumber) {
    const modal = document.getElementById('editIssueModal');
    
    // Use passed element instead of global selector
    const currentTitle = issueElement.querySelector('.issue-title').textContent.split('#')[1].trim();
    const currentBody = issueElement.querySelector('.issue-body').textContent;

    document.getElementById('editIssueNumber').value = issueNumber;
    document.getElementById('editTitle').value = currentTitle;
    document.getElementById('editBody').value = currentBody;

    modal.style.display = 'block';
}

async function handleEditIssue(event) {
    event.preventDefault();
    
    const form = document.getElementById('editIssueForm');
    const issueNumber = parseInt(document.getElementById('editIssueNumber').value);
    const newTitle = document.getElementById('editTitle').value;
    const newBody = document.getElementById('editBody').value;
    const path = document.getElementById('repoPath').value;

    try {
        await fetch('/api/local/issues', {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                path: path,
                issueNumber: issueNumber,
                title: newTitle,
                body: newBody
            })
        });
        
        closeModal('editIssueModal');
        window.location.reload(); // or update the UI dynamically
    } catch (err) {
        alert("Error saving changes");
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.style.display = 'none';
}

// Add this at the end of the home.html file
<div id="editIssueModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('editIssueModal')">&times;</span>
        <h2>Edit Issue</h2>
        <form id="editIssueForm" onsubmit="handleEditIssue(event)">
            <input type="hidden" id="editIssueNumber">
            <input type="hidden" id="repoPath" value="{{.Repository.Path}}">
            <div class="form-group">
                <label for="editTitle">Title</label>
                <input type="text" id="editTitle" class="input" required>
            </div>
            <div class="form-group">
                <label for="editBody">Body</label>
                <textarea id="editBody" class="input" required></textarea>
            </div>
            <button type="submit" class="button">Save Changes</button>
        </form>
    </div>
</div>
