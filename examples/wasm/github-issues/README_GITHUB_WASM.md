#!/bin/bash

# This script demonstrates how to use the GitHub issues fetcher WASM module
# It assumes you have already registered the module with the system

echo "To use the GitHub issues fetcher WASM module:"
echo ""
echo "1. First, register the module with the system:"
echo "   go run register_github_wasm.go"
echo ""
echo "2. Then, you can execute the module with configuration like this:"
echo ""
echo "   curl -X POST http://localhost:8080/api/v1/wasm-modules/{module-id}/execute \\"
echo "     -H \"Content-Type: application/json\" \\"
echo "     -d '{"
echo "           \"repo_url\": \"https://github.com/your-org/your-repo\","
echo "           \"token\": \"your-github-token\""
echo "         }'"
echo ""
echo "Or with filter configuration:"
echo ""
echo "   curl -X POST http://localhost:8080/api/v1/wasm-modules/{module-id}/execute \\"
echo "     -H \"Content-Type: application/json\" \\"
echo "     -d '{"
echo "           \"repo_url\": \"https://github.com/your-org/your-repo\","
echo "           \"token\": \"your-github-token\","
echo "           \"filters\": {"
echo "             \"state\": \"open\","
echo "             \"assignee\": \"@me\","
echo "             \"per_page\": 30,"
echo "             \"fetch_comments\": true"
echo "           }"
echo "         }'"
echo ""
echo "Or in a workflow step, you would configure it like:"
echo ""
echo "  {"
echo "    \"type\": \"WASM\","
echo "    \"wasm_module_id\": \"{module-id}\","
echo "    \"config\": {"
echo "      \"repo_url\": \"https://github.com/your-org/your-repo\","
echo "      \"token\": \"your-github-token\","
echo "      \"filters\": {"
echo "        \"state\": \"open\","
echo "        \"assignee\": \"@me\","
echo "        \"per_page\": 30,"
echo "        \"fetch_comments\": true"
echo "      }"
echo "    }"
echo "  }"
echo ""
echo "Filter options:"
echo "  - state: \"open\", \"closed\", or \"all\""
echo "  - assignee: username, \"none\" for unassigned, \"*\" for any assigned, \"@me\" for token owner"
echo "  - labels: comma-separated label names"
echo "  - sort: \"created\", \"updated\", or \"comments\""
echo "  - direction: \"asc\" or \"desc\""
echo "  - per_page: results per page (max 100)"
echo "  - page: page number"
echo "  - fetch_comments: boolean, whether to fetch comments for issues (default: false)"
echo ""
echo "The module will output a JSON object with the issues and count:"
echo ""
echo "  {"
echo "    \"issues\": ["
echo "      {"
echo "        \"id\": 123456,"
echo "        \"number\": 1,"
echo "        \"title\": \"Issue title\","
echo "        \"state\": \"open\","
echo "        \"url\": \"https://github.com/owner/repo/issues/1\","
echo "        \"body\": \"Issue description\","
echo "        \"comments\": 5,"
echo "        \"assignee\": {"
echo "          \"login\": \"username\","
echo "          \"id\": 12345,"
echo "          \"avatar_url\": \"https://avatars.githubusercontent.com/u/12345?v=4\","
echo "          \"url\": \"https://api.github.com/users/username\""
echo "        },"
echo "        \"assignees\": ["
echo "          {"
echo "            \"login\": \"username\","
echo "            \"id\": 12345,"
echo "            \"avatar_url\": \"https://avatars.githubusercontent.com/u/12345?v=4\","
echo "            \"url\": \"https://api.github.com/users/username\""
echo "          }"
echo "        ],"
echo "        \"comments_data\": ["
echo "          {"
echo "            \"id\": 789012,"
echo "            \"body\": \"Comment text\","
echo "            \"user\": {"
echo "              \"login\": \"commenter\","
echo "              \"id\": 67890,"
echo "              \"avatar_url\": \"https://avatars.githubusercontent.com/u/67890?v=4\","
echo "              \"url\": \"https://api.github.com/users/commenter\""
echo "            },"
echo "            \"created_at\": \"2023-01-01T12:00:00Z\","
echo "            \"updated_at\": \"2023-01-01T12:00:00Z\","
echo "            \"url\": \"https://api.github.com/repos/owner/repo/issues/comments/789012\""
echo "          }"
echo "        ]"
echo "      }"
echo "    ],"
echo "    \"count\": 1"
echo "  }"